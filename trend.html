<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Trend Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    select { padding: 6px; margin-right: 10px; }
    #chart { width: 100%; height: 900px; }
  </style>
</head>
<body>

<h2>Trend & Momentum</h2>

<label>Index:</label>
<select id="index">
  <option value="nifty50">NIFTY 50</option>
  <option value="nifty_total">Total Market</option>
</select>

<div id="chart"></div>

<script>
const FILE = "data/history/breadth_full_history.csv";

const PLOT_CONFIG = {
  responsive:true, scrollZoom:false, doubleClick:false,
  displaylogo:false,
  modeBarButtonsToRemove:[
    "zoom2d","select2d","lasso2d",
    "zoomIn2d","zoomOut2d","autoScale2d"
  ]
};

let rows;

fetch(FILE).then(r=>r.text()).then(t=>{
  const l=t.trim().split("\n");
  const h=l[0].split(",");
  rows=l.slice(1).map(r=>{
    const v=r.split(",");
    let o={}; h.forEach((k,i)=>o[k]=+v[i]||v[i]); return o;
  });
  draw();
});

document.getElementById("index").onchange=draw;

function draw(){
  const idx=document.getElementById("index").value;
  const x=rows.map(r=>new Date(r.Date));

  const traces=[
    {
      x,y:rows.map(r=>r[`${idx}_dist_200_z`]),
      name:"Distance from 200DMA (Z)",
      yaxis:"y1", line:{width:2}
    },
    {
      x,y:rows.map(r=>r[`${idx}_mom_126`]),
      name:"6M Momentum",
      yaxis:"y2", line:{dash:"dot"}
    }
  ];

  const layout={
    dragmode:"pan",
    hovermode:"x unified",
    yaxis:{title:"Trend (Z)"},
    yaxis2:{title:"Momentum",overlaying:"y",side:"right"},
    margin:{t:40}
  };

  Plotly.newPlot("chart",traces,layout,PLOT_CONFIG);
}
</script>
</body>
</html>
