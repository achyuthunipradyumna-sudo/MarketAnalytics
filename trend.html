<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Trend Dashboard</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>

<body>
<h2>Trend & Momentum</h2>

<select id="idx">
<option value="nifty50">NIFTY 50</option>
<option value="nifty_total">NIFTY TOTAL MARKET</option>
</select>

<div id="chart"></div>

<script>
const DATA="data/history/breadth_full_history.csv";
const CFG={responsive:true,scrollZoom:false,doubleClick:false};

fetch(DATA).then(r=>r.text()).then(t=>{
 const rows=t.trim().split("\n");
 const h=rows[0].split(",");
 const d=rows.slice(1).map(r=>{let o={};r.split(",").forEach((v,i)=>o[h[i]]=v);return o});
 render(d);
});

function render(d){
 const idx=document.getElementById("idx").value;
 Plotly.newPlot("chart",[
  {x:d.map(r=>r.Date),y:d.map(r=>+r[`${idx}_dist_200_z`]),name:"Dist 200DMA Z"},
  {x:d.map(r=>r.Date),y:d.map(r=>+r[`${idx}_mom_126`]),name:"6M Momentum"}
 ],{
  dragmode:"pan",hovermode:"x unified",
  yaxis:{title:"Z / Momentum"}
 },CFG);
}
document.getElementById("idx").onchange=()=>location.reload();
</script>
</body>
</html>
