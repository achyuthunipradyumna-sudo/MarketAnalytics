<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Volatility Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    select { margin-right: 12px; padding: 4px; }
    #chart { width: 100%; height: 750px; }
  </style>
</head>
<body>

<h2>Volatility & Risk</h2>

<label>Index:</label>
<select id="index">
  <option value="nifty50">NIFTY 50</option>
  <option value="nifty_total">Total Market</option>
</select>

<div id="chart"></div>

<script>
const DATA_URL = "data/history/breadth_full_history.csv";
let raw;

fetch(DATA_URL)
  .then(r => r.text())
  .then(text => {
    const rows = text.trim().split("\n");
    const header = rows[0].split(",");
    raw = rows.slice(1).map(r => {
      const o = {};
      r.split(",").forEach((v, i) => o[header[i]] = v);
      return o;
    });
    render();
  });

function render() {
  const idx = document.getElementById("index").value;
  const x = raw.map(d => new Date(d.Date));

  const traces = [
    {
      x, y: raw.map(d => +d[`${idx}_vol_20_z`]),
      name: "Index Vol Z(20)",
      line: {width: 2}
    },
    {
      x, y: raw.map(d => +d.median_stock_vol_20_z),
      name: "Median Stock Vol Z",
      line: {dash: "dot"}
    }
  ];

  Plotly.newPlot("chart", traces, {
    title: idx.toUpperCase() + " Volatility Regime",
    hovermode: "x unified",
    legend: {orientation: "h"},
    yaxis: {zeroline: true}
  }, {
    scrollZoom: false
  });
}

document.getElementById("index").onchange = render;
</script>

</body>
</html>
