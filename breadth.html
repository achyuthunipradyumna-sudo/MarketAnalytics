<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Breadth Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    select { margin-right: 12px; padding: 4px; }
    #chart { width: 100%; height: 750px; }
  </style>
</head>
<body>

<h2>Breadth Dashboard</h2>

<label>Metric:</label>
<select id="mode">
  <option value="z">Z-Scores</option>
</select>

<div id="chart"></div>

<script>
const DATA_URL = "data/history/breadth_full_history.csv";

fetch(DATA_URL)
  .then(r => r.text())
  .then(text => {
    const rows = text.trim().split("\n");
    const header = rows[0].split(",");
    const data = rows.slice(1).map(r => {
      const o = {};
      r.split(",").forEach((v, i) => o[header[i]] = v);
      return o;
    });

    const x = data.map(d => new Date(d.Date));

    const traces = [
      {
        x, y: data.map(d => +d.ad_z_50),
        name: "Advance–Decline Z(50)",
        line: {width: 2}
      },
      {
        x, y: data.map(d => +d.pct_above_20dma_z),
        name: "% Stocks > 20 DMA (Z)"
      },
      {
        x, y: data.map(d => +d.pct_above_50dma_z),
        name: "% Stocks > 50 DMA (Z)"
      },
      {
        x, y: data.map(d => +d.pct_above_200dma_z),
        name: "% Stocks > 200 DMA (Z)"
      },
      {
        x, y: data.map(d => +d.nhnl_z),
        name: "New High – New Low Z"
      }
    ];

    Plotly.newPlot("chart", traces, {
      title: "Market Breadth (Full History)",
      hovermode: "x unified",
      legend: {orientation: "h"},
      yaxis: {zeroline: true},
    }, {
      scrollZoom: false
    });
  });
</script>

</body>
</html>
