<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Breadth Dashboard</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>

<style>
body { font-family: Arial; margin: 20px; }
.controls { margin-bottom: 12px; }
button { margin-right: 6px; padding: 6px 10px; }
</style>
</head>

<body>
<h2>Breadth â€” Participation & Internal Strength</h2>

<div class="controls">
  Index:
  <select id="indexSel">
    <option value="nifty50">NIFTY 50</option>
    <option value="nifty_total">NIFTY TOTAL MARKET</option>
  </select>

  Range:
  <button onclick="setRange(30)">1M</button>
  <button onclick="setRange(90)">3M</button>
  <button onclick="setRange(180)">6M</button>
  <button onclick="setRange(365)">1Y</button>
  <button onclick="setRange(1825)">5Y</button>
  <button onclick="setRange('all')">All</button>
</div>

<div id="chart"></div>

<script>
const DATA_URL = "data/history/breadth_full_history.csv";
let RAW = [];
let RANGE = 365;

const PLOT_CONFIG = {
  responsive:true, scrollZoom:false, doubleClick:false,
  displaylogo:false,
  modeBarButtonsToRemove:[
    "zoom2d","select2d","lasso2d",
    "zoomIn2d","zoomOut2d","autoScale2d"
  ]
};

fetch(DATA_URL)
.then(r=>r.text())
.then(t=>{
  const rows=t.trim().split("\n");
  const h=rows[0].split(",");
  RAW=rows.slice(1).map(r=>{
    const o={}; r.split(",").forEach((v,i)=>o[h[i]]=v); return o;
  });
  render();
});

function setRange(r){ RANGE=r; render(); }

function render(){
  const d = RANGE==="all"? RAW : RAW.slice(-RANGE);
  const x = d.map(r=>r.Date);

  const traces = [
    {x,y:d.map(r=>+r.ad_z_50), name:"AD Z(50)"},
    {x,y:d.map(r=>+r.pct_above_20dma_z), name:"%>20DMA Z"},
    {x,y:d.map(r=>+r.pct_above_50dma_z), name:"%>50DMA Z"},
    {x,y:d.map(r=>+r.pct_above_200dma_z), name:"%>200DMA Z"},
    {x,y:d.map(r=>+r.nhnl_z), name:"NH-NL Z"}
  ];

  Plotly.newPlot("chart", traces, {
    dragmode:"pan",
    hovermode:"x unified",
    yaxis:{zeroline:true,title:"Z-Score"},
    legend:{orientation:"h"}
  }, PLOT_CONFIG);
}
</script>
</body>
</html>
