<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Breadth Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>
<body>

<h3>Breadth â€” Participation & Internal Strength</h3>
<div id="chart"></div>

<script>
fetch("data/breadth_full_history.csv")
.then(r => r.text())
.then(text => {
  const rows = text.trim().split("\n");
  const h = rows[0].split(",");
  const d = rows.slice(1).map(r => {
    let o = {};
    r.split(",").forEach((v,i)=>o[h[i]]=v);
    return o;
  });

  const x = d.map(r => r.Date);

  const traces = [
    { x, y: d.map(r=>+r.ad_z_50), name:"AD Z(50)" },
    { x, y: d.map(r=>+r.pct_above_20dma_z), name:"%>20DMA Z" },
    { x, y: d.map(r=>+r.pct_above_50dma_z), name:"%>50DMA Z" },
    { x, y: d.map(r=>+r.pct_above_200dma_z), name:"%>200DMA Z" },
    { x, y: d.map(r=>+r.nhnl_z), name:"NH-NL Z" }
  ];

  Plotly.newPlot("chart", traces, {
    height: 600,
    hovermode: "x unified",
    shapes:[{type:"line",x0:0,x1:1,y0:0,y1:0,xref:"paper"}],
    xaxis: {
      rangeselector: {
        buttons:[
          {count:1,label:"1M",step:"month",stepmode:"backward"},
          {count:3,label:"3M",step:"month",stepmode:"backward"},
          {count:1,label:"1Y",step:"year",stepmode:"backward"},
          {count:5,label:"5Y",step:"year",stepmode:"backward"},
          {step:"all"}
        ]
      }
    }
  },{
    scrollZoom:false,
    doubleClick:false
  });
});
</script>

</body>
</html>
